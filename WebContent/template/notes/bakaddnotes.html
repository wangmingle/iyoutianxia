<!DOCTYPE html>
<html>
<head>
<meta/>
<title>爱游天下-iyoutianxia</title>
<meta name="description" content="Administry - Admin Template by www.865171.cn" />
<meta name="keywords" content="Admin,Template" />
<link rel="shortcut icon" type="image/png" HREF="../../img/favicons/favicon.png"/>
<link rel="icon" type="image/png" HREF="../../img/favicons/favicon.png"/>
<link rel="apple-touch-icon" HREF="../../img/favicons/apple.png" />
<link rel="stylesheet" href="../../css/style.css" type="text/css" />
<link rel="stylesheet" href="../../css/custom.css" type="text/css" />
<script type="text/javascript" SRC="../../js/swfobject.js"></script>
<script type="text/javascript" SRC="../../js/jquery-1.4.2.min.js"></script>
<script type="text/javascript" SRC="../../js/jquery.ui.core.min.js"></script>
<script type="text/javascript" SRC="../../js/jquery.ui.widget.min.js"></script>
<script type="text/javascript" SRC="../../js/jquery.ui.tabs.min.js"></script>
<script type="text/javascript" SRC="../../js/jquery.tipTip.min.js"></script>
<script type="text/javascript" SRC="../../js/jquery.superfish.min.js"></script>
<script type="text/javascript" SRC="../../js/jquery.supersubs.min.js"></script>
<script type="text/javascript" SRC="../../js/jquery.nyroModal.pack.js"></script>
<script type="text/javascript" SRC="../../js/jquery.validate_pack.js"></script>
<script type="text/javascript" SRC="../../js/jquery.tagInput.min.js"></script>
<script type="text/javascript" SRC="../../js/jquery.wysiwyg.min.js"></script>

<script type="text/javascript" SRC="../../js/jquery.contextmenu.r2.js"></script>
<!-- Internet Explorer Fixes --> 
<!--[if IE]>
<link rel="stylesheet" type="text/css" media="all" href="../../css/ie.css"/>
<script src="../../js/html5.js"></script>
<![endif]-->
<!--Upgrade MSIE5.5-7 to be compatible with MSIE8: http://ie7-js.googlecode.com/svn/version/2.1(beta3)/IE8.js -->
<!--[if lt IE 8]>
<script src="../../js/IE8.js"></script>
<![endif]-->
<script type="text/javascript">

/* sample tags */
var tags=[
	{tag:"js",freq:30},{tag:"jquery",freq:25}, {tag:"pojo",freq:10},{tag:"agile",freq:4},
	{tag:"blog",freq:3},{tag:"canvas",freq:8}, {tag:"dialog",freq:3},{tag:"excel",freq:4},
	{tag:"engine",freq:5},{tag:"flex",freq:18}, {tag:"firefox",freq:23},{tag:"javascript",freq:40},
	{tag:"graph",freq:15},{tag:"grid",freq:20}, {tag:"hibernate",freq:13},{tag:"ical",freq:4},
	{tag:"ldap",freq:9},{tag:"load",freq:20}, {tag:"security",freq:13},{tag:"XSS",freq:21},
	{tag:"CSRF",freq:19},{tag:"html",freq:22}, {tag:"xml",freq:13},{tag:"tools",freq:21}
];

$(document).ready(function(){
	
	/* setup navigation, content boxes, etc... */
	Administry.setup();
	
	$('#productdesc').wysiwyg({
    controls: {
      strikeThrough : { visible : true },
      underline     : { visible : true },
      
      justifyLeft   : { visible : true },
      justifyCenter : { visible : true },
      justifyRight  : { visible : true },
      justifyFull   : { visible : true },
      
      indent  : { visible : true },
      outdent : { visible : true },
      
      subscript   : { visible : true },
      superscript : { visible : true },
      
      undo : { visible : true },
      redo : { visible : true },
      
      insertOrderedList    : { visible : true },
      insertUnorderedList  : { visible : true },
      insertHorizontalRule : { visible : true },

      h4: {
              visible: true,
              className: 'h4',
              command: $.browser.msie ? 'formatBlock' : 'heading',
              arguments: [$.browser.msie ? '<h4>' : 'h4'],
              tags: ['h4'],
              tooltip: 'Header 4'
      },
      h5: {
              visible: true,
              className: 'h5',
              command: $.browser.msie ? 'formatBlock' : 'heading',
              arguments: [$.browser.msie ? '<h5>' : 'h5'],
              tags: ['h5'],
              tooltip: 'Header 5'
      },
      h6: {
              visible: true,
              className: 'h6',
              command: $.browser.msie ? 'formatBlock' : 'heading',
              arguments: [$.browser.msie ? '<h6>' : 'h6'],
              tags: ['h6'],
              tooltip: 'Header 6'
      },
      
      cut   : { visible : true },
      copy  : { visible : true },
      paste : { visible : true },
      html  : { visible: true }
    }
  }); 
  
	/* tag input field */
	$("#tags").tagInput({
		tags:tags,
		//jsonUrl:"tags.json",
		sortBy:"frequency",
		suggestedTags:["jquery", "tagging", "tag", "component", "delicious", "javascript"],
		tagSeparator:" ",
		autoFilter:true,
		autoStart:false,
		//suggestedTagsPlaceHolder:$("#suggested"),
		boldify:true
	});


});


</script>
</head>
<body>
	<!-- Header -->
	<!-- #include /header.html -->
	<!-- End of Header -->
	<!-- Page title -->
	<div id="pagetitle">
		<div class="wrapper">
			<h1>社区 &rarr; <span>游记</span></h1>
			<!-- Quick search box -->
			<form action="" method="get"><input class="" type="text" id="q" name="q" /></form>
		</div>
	</div>
	<!-- End of Page title -->
	
	<!-- Page content -->
	<div id="page">
		<!-- Wrapper -->
		<div class="wrapper">
				<!-- Left column/section -->
				<section class="column width6 first">					

					<h3>发表新游记</h3>
					
					<form id="sampleform" method="post" action="/notes/pub" onsubmit="return checks();">
						<input type="hidden" id="notesFlag" value="add" name="notesFlag"/>
						<input type="hidden" id="notesTags" value="" name="tags"/>
						<input type="hidden" id="context2" value="" name="context2"/>
						<fieldset>
							<legend>游记信息</legend>

							<p>
								<label class="required" for="producttitle">标题</label><br/>
								<input type="text" id="producttitle" class="half title" value="" name="name"/>
								<small>游记标题突出关键词便于检索</small>
							</p>

							<p>
								<label for="productdesc">游记详细</label><br/>
								<a href="javascript:selectAlbum();" class="btn"><span class="icon icon-add">&nbsp;</span>从爱游相册中添加</a>
								<!--<textarea id="productdesc" class="large full" name="context"></textarea>
							-->
								<div id="editdiv" class="context1" contentEditable="true" style="HEIGHT:500px;WIDTH:720px;PADDING-RIGHT:0px;OVERFLOW-Y:auto;PADDING-LEFT:0px;  
					            SCROLLBAR-FACE-COLOR:#CC9999;PADDING-BOTTOM:0px;  
					            SCROLLBAR-HIGHLIGHT-COLOR:#CCFFFF;OVERFLOW:auto;  
					            SCROLLBAR-TRACK-COLOR:#ffffff;SCROLLBAR-ARROW-COLOR:#919192;  
					            SCROLLBAR-DARKSHADOW-COLOR:#ffffff;  
					            SCROLLBAR-SHADOW-COLOR:#919192;SCROLLBAR-3DLIGHT-COLOR:#ffffff;  
					            LINE-HEIGHT:100%;PADDING-TOP:5px;  
					            FONT-SIZE:11pt;FONT-FAMILY:宋体;COLOR:black;LETTER-SPACING:1pt;  
					            TEXT-ALIGN:left;border:1px #c4c4c4 solid;">开始写游记</div>
							</p>
							<script type="text/javascript">
								function selectAlbum(){
									var url="/album/select";
									var str=window.showModalDialog(url,'','dialogWidth =670px;dialogHeight =550px;status=no;resizable=no;');
									if(str!=null){
										var arr=str;
										//alert(arr.length);
										//var strs=arr.split("/");
										for(var i=0;i<arr.length;i++){
											//if(arr[i]!=null &&　""!=arr[i] && "undefined"!=arr[i]){
										//		var s=strs[i].split("-");
										//		var imgstr='<img id="'+s[0]+'" name="'+s[1]+'" src="http://localhost:8090/uploadify/uploads/medium/'+s[1]+'" ></br>';
												
												//alert(arr[i]);
												c2.insertText(arr[i]);
											//}
											
										}
										$('div.contextMenu').hide();
										//alert(arr);
										//var uuid=str[0];
										//var company=str[1];
										//fcb(uuid,company);
										//window.location.reload();
										//document.getElementById("albumid").value=str;
									}
								}	
							</script>
							<div class="clearfix leading">
								<div class="column width3 first">
									<p>
										<label for="productcat">游记类型</label><br/>
										<select id="productcat" class="full" name="productcat">
											
										</select>
										<small></small>
									</p>
									<p><a href="#">+ 自定义游记类型</a></p>
								</div>
							</div>
						
							<p class="box"><input type="submit" class="btn btn-green big" value="保存"/> or <a href="#">取消</a></p>

						</fieldset>

					</form>

				</section>
				<!-- End of Left column/section -->
				
				<!-- Right column/section -->
				<aside class="column width2">
					<p><a href="#" class="btn btn-special btn-green"><img SRC="../../img/page_white_go.png" class="icon" alt=""/>游记预览</a></p>
					<p><a href="#" class="btn btn-special"><img SRC="../../img/page_save.png" class="icon" alt=""/>保存游记</a></p>
					<div class="content-box">
						<header>
							<h3>权限信息</h3>
						</header>
						<section>
							请选择游记的权限信息，公开：任何人都可以批注，私有：不允许其他人批注。
							<p>
								<select id="visibility" class="full" name="visibility">
									<option value="1" selected>公开</option>
									<option value="2">私有</option>
								</select>
							</p>
						</section>
					</div>
					<div class="content-box">
						<header>
							<h3>游记标签</h3>
						</header>
						<section>
							请选择或输入游记标签，这样更便于其他人找到你的游记，标签之间用空格隔开
							<p><textarea id="tags" class="small full" name="tags"></textarea></p>
						</section>
					</div>
					<div id="rightmenu">
						<dl class="first">
							<dt><img width="16" height="16" alt="" SRC="../../img/help.png"></dt>
							<dd><a href="#">帮助</a></dd>
							<dd class="last">如果你需要帮助，请查看帮助信息</dd>							
						</dl>
					</div>
				</aside>
				<!-- End of Right column/section -->
				
		</div>
		<!-- End of Wrapper -->
	</div>
	<!-- End of Page content -->
	
	<!-- Page footer -->
	<footer id="bottom">
		<div class="wrapper">
			<nav>
				<a href="#">Dashboard</a> &middot;
				<a href="#">Content</a> &middot;
				<a href="#">Reports</a> &middot;
				<a href="#">Users</a> &middot;
				<a href="#">Media</a> &middot;
				<a href="#">Events</a> &middot;
				<a href="#">Newsletter</a> &middot;
				<a href="#">Settings</a>
			</nav>
			<p>Copyright &copy; 2010 <b><a HREF="http://www.865171.cn" title="www.865171.cn">www.865171.cn</a></b> | Icons by <a HREF="http://www.865171.cn">865171.cn</a></p>
		</div>
	</footer>
	<!-- End of Page footer -->
	
	<!-- Animated footer -->
	<footer id="animated">
		<ul>
			<li><a href="#">Dashboard</a></li>
			<li><a href="#">Content</a></li>
			<li><a href="#">Reports</a></li>
			<li><a href="#">Users</a></li>
			<li><a href="#">Media</a></li>
			<li><a href="#">Events</a></li>
			<li><a href="#">Newsletter</a></li>
			<li><a href="#">Settings</a></li>
		</ul>
	</footer>
	<!-- End of Animated footer -->
	
	<!-- Scroll to top link -->
	<a href="#" id="totop">^ scroll to top</a>

<!-- User interface javascript load -->
<script type="text/javascript" SRC="../../js/administry.js"></script>
<script type="text/javascript">
function cursorControl(a){
    this.element=a;
    this.range=!1;
    this.start=0;
    this.init();
};
cursorControl.prototype={
    init:function(){
        var _that=this;
        this.element.onkeyup=this.element.onmouseup=function(){
            this.focus();
            if(document.all){
                _that.range=document.selection.createRange();
            }else{
                _that.start=_that.getStart();
            }
        }
    },
    getType:function(){
        return Object.prototype.toString.call(this.element).match(/^\[object\s(.*)\]$/)[1];
    },
    getStart:function(){
        if (this.element.selectionStart || this.element.selectionStart == '0'){  
            return this.element.selectionStart; 
        }
         
//        else if (window.getSelection){  
//            var rng = window.getSelection().getRangeAt(0).cloneRange();  
//            rng.setStart(this.element,0);  
//           return rng.toString().length;
//        }
    },
    insertText:function(text){
        this.element.focus();  
        if(document.all){
            document.selection.empty();  
            this.range.text = text;  
            this.range.collapse();  
            this.range.select();
        }  
        else{
            if(this.getType()=='HTMLDivElement'){
                //this.element.innerHTML=this.element.innerHTML.substr(0,this.start)+text+this.element.innerHTML.substr(this.start);
                // Begain of The Content added by bedweather 
                var sel = window.getSelection();
                var rang = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;
                if (rang == undefined 
                    || rang == null
                    || (rang.commonAncestorContainer.id !="editdiv"
                        && rang.commonAncestorContainer.parentNode.id !="editdiv")){
                    this.element.focus();
                    rang = document.createRange();
                    rang = selectNode(this.element);
                    rang.setStart(range.getEndContainer, rang.endOffset);
                }
                rang.deleteContents();
                rang.insertNode(rang.createContextualFragment(text));
                var tempRange = document.createRange();
                var a = document.getElementById("editdiv")
                tempRange.selectNodeContents(a);
                if(rang.commonAncestorContainer.id == "editdiv"){
                    tempRange.setStart(rang.endContainer, rang.endOffset+1);
                    tempRange.setEnd(rang.endContainer, rang.endOffset+1);
                } else {
                    tempRange.setStartAfter(rang.endContainer.nextSibling);
                    tempRange.setEndAfter(rang.endContainer.nextSibling);
                }
                sel.removeAllRanges();
                sel.addRange(tempRange);
                this.element.focus();
                // End of The Content added by bedweather 
 
            }else{
                this.element.value=this.element.value.substr(0,this.start)+text+this.element.value.substr(this.start);
            };
        } 
    },
    getText:function(){
        if (document.all){  
            var r = document.selection.createRange();  
            document.selection.empty();  
            return r.innerHTML;  
        }  
        else{  
            if (this.element.selectionStart || this.element.selectionStart == '0'){
                var text=this.getType()=='HTMLDivElement'?this.element.innerHTML:this.element.value;
                return text.substring(this.element.selectionStart,this.element.selectionEnd); 
            } 
            else if (window.getSelection){  
                return window.getSelection().toString()
            };  
        }  
    },
    getHtml:function(){
        return this.element.innerHTML; 
    }
};
var c1,c2;
window.onload=function(){
    //c1=new cursorControl(document.getElementById('text'));
    c2=new cursorControl(document.getElementById('editdiv'));
};
function fn1(str){
    c1.insertText(str);
};
function fn2(str){
    c2.insertText('<img src="../images/ditu.png"/>');
};
function fn3(){
    alert(c2.getHtml());
};
function fn4(){
    //alert(c2.getHtml());
    var txt=c2.getText();
    document.execCommand('CreateLink', true, "http://www.baidu.com");
}     


function checks(){
	//alert(c2.getHtml());
	document.getElementById("context2").value=c2.getHtml();
	return true;
}
</script>  
<!--  Context menu -->
<div class="contextMenu" id="myMenu3">

    <ul>

      <li id="item_1" onclick="">上传图片</li>

      <li id="item_2" onclick="javascript:selectAlbum();">从相册中添加</li>

      <li id="item_3">标记为链接</li>

    </ul>

  </div>
<script type="text/javascript">
$('div.context1').contextMenu('myMenu3', {

      onContextMenu: function(e) {

        if ($(e.target).attr('id') == 'dontShow') return false;

        else return true;

      },

      onShowMenu: function(e, menu) {

        if ($(e.target).attr('id') == 'showOne') {

          $('#item_2, #item_3', menu).remove();

        }

        return menu;

      }

    });
</script>

</body>
</html>